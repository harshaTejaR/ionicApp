import{a as S,b as h,c as p}from"./chunk-7YESJSHY.js";import{a as U,e as l,g as c,ib as E}from"./chunk-BP6JKRVK.js";import{a as m,b as v}from"./chunk-3J7GGTVR.js";import{a as g,b as y,f as a}from"./chunk-RW4GY4BD.js";var d=(()=>{let s=class s{get(e){return a(this,null,function*(){try{let r=yield S.readFile({path:`${e}.json`,directory:m.Data,encoding:v.UTF8});return JSON.parse(r.data)}catch{return console.log(`No ${e} file found`),null}})}set(e,r){return a(this,null,function*(){try{yield S.writeFile({path:`${e}.json`,data:JSON.stringify(r,null,2),directory:m.Data,encoding:v.UTF8})}catch(t){throw console.error(`Error saving ${e}:`,t),t}})}remove(e){return a(this,null,function*(){try{yield S.deleteFile({path:`${e}.json`,directory:m.Data})}catch(r){console.error(`Error removing ${e}:`,r)}})}clear(){return a(this,null,function*(){try{console.log("Storage clear operation called")}catch(e){console.error("Error clearing storage:",e)}})}getFromLocalStorage(e){try{let r=localStorage.getItem(e);return r?JSON.parse(r):null}catch(r){return console.error(`Error getting ${e} from localStorage:`,r),null}}setToLocalStorage(e,r){try{localStorage.setItem(e,JSON.stringify(r))}catch(t){console.error(`Error setting ${e} to localStorage:`,t)}}removeFromLocalStorage(e){try{localStorage.removeItem(e)}catch(r){console.error(`Error removing ${e} from localStorage:`,r)}}};s.\u0275fac=function(r){return new(r||s)},s.\u0275prov=l({token:s,factory:s.\u0275fac,providedIn:"root"});let i=s;return i})();var w=(()=>{let s=class s{constructor(e,r){this.platform=e,this.storageService=r,this.currentUserSubject=new U(null),this.currentUser$=this.currentUserSubject.asObservable(),this.users=[],this.USERS_STORAGE_KEY="users",this.initializeGoogleAuth(),this.loadUsers(),this.restoreUserSession()}initializeGoogleAuth(){return a(this,null,function*(){try{yield this.platform.ready(),yield h.initialize({clientId:p.googleAuth.clientId,scopes:p.googleAuth.scopes,grantOfflineAccess:!0})}catch(e){console.error("Failed to initialize Google Auth:",e)}})}signInWithGoogle(){return a(this,null,function*(){try{if(console.log("Starting Google Sign In..."),!h)throw console.error("GoogleAuth is not available"),new Error("GoogleAuth is not properly initialized");let e=yield h.signIn();if(console.log("Google Sign In successful:",e),!e||!e.email)throw console.error("Invalid Google user data received"),new Error("Invalid user data received from Google");let r={id:e.id,email:e.email,name:e.name,imageUrl:e.imageUrl,registeredAt:new Date().toISOString(),authMethod:"google"};console.log("User object created:",r);let t=this.users.find(o=>o.id===r.id);return t?(Object.assign(t,r),yield this.saveUsers(),console.log("Existing user updated in storage")):(this.users.push(r),yield this.saveUsers(),console.log("New user saved to storage")),this.currentUserSubject.next(r),this.saveUserSession(r),r}catch(e){throw console.error("Google Sign In failed:",e),this.handleAuthError(e)}})}registerWithEmail(e,r,t){return a(this,null,function*(){try{if(this.getUserByEmail(e))throw new Error("User with this email already exists");if(!this.isValidEmail(e))throw new Error("Please enter a valid email address");if(r.length<6)throw new Error("Password must be at least 6 characters long");let n={id:this.generateUserId(),email:e.toLowerCase(),name:t,registeredAt:new Date().toISOString(),authMethod:"email",password:yield this.hashPassword(r)};this.users.push(n),yield this.saveUsers();let u=g({},n);return delete u.password,this.currentUserSubject.next(u),this.saveUserSession(u),console.log("User registered successfully:",u),u}catch(o){throw console.error("Registration failed:",o),o}})}signInWithEmail(e,r){return a(this,null,function*(){try{let t=this.getUserByEmail(e.toLowerCase());if(!t)throw new Error("Invalid email or password");if(t.authMethod!=="email")throw new Error("This email is registered with a different method");if(!(yield this.verifyPassword(r,t.password)))throw new Error("Invalid email or password");let n=g({},t);return delete n.password,this.currentUserSubject.next(n),this.saveUserSession(n),console.log("User signed in successfully:",n),n}catch(t){throw console.error("Sign in failed:",t),t}})}signOut(){return a(this,null,function*(){var e;try{yield this.saveWorkProgressBeforeLogout(),((e=this.currentUserSubject.value)==null?void 0:e.authMethod)==="google"&&(yield h.signOut()),this.currentUserSubject.next(null),this.clearUserSession(),console.log("User signed out successfully")}catch(r){console.error("Sign out failed:",r)}})}getCurrentUser(){return a(this,null,function*(){let e=this.getCurrentUserSync();if(e)return e;try{let r=yield h.signIn();if(r){let t={id:r.id,email:r.email,name:r.name,imageUrl:r.imageUrl,registeredAt:new Date().toISOString(),authMethod:"google"};return this.currentUserSubject.next(t),this.saveUserSession(t),t}return null}catch{return null}})}isAuthenticated(){return this.currentUserSubject.value!==null}requestPasswordReset(e){return a(this,null,function*(){let r=this.getUserByEmail(e.toLowerCase());if(!r)throw new Error("Email not found");if(r.authMethod!=="email")throw new Error("Password reset not supported for this account");r.resetToken=this.generateToken(),r.resetTokenExpiry=new Date(Date.now()+36e5).toISOString(),yield this.saveUsers(),console.log("Reset token generated and saved for user:",r.email)})}resetPassword(e,r,t){return a(this,null,function*(){let o=this.getUserByEmail(e.toLowerCase());if(!o)throw new Error("User not found");if(!o.resetToken||o.resetToken!==r)throw new Error("Invalid password reset token");if(!o.resetTokenExpiry||new Date(o.resetTokenExpiry)<new Date)throw new Error("Password reset token has expired");if(t.length<6)throw new Error("Password must be at least 6 characters long");o.password=yield this.hashPassword(t),delete o.resetToken,delete o.resetTokenExpiry,yield this.saveUsers(),console.log("Password reset successful for user:",o.email)})}getUserByEmail(e){return this.users.find(r=>r.email===e)}getCurrentUserSync(){return this.currentUserSubject.value}isEmailRegistered(e){return this.getUserByEmail(e.toLowerCase())!==void 0}getTotalUsers(){return this.users.length}getUsersByAuthMethod(e){return this.users.filter(r=>r.authMethod===e)}loadUsers(){return a(this,null,function*(){try{let e=yield this.storageService.get(this.USERS_STORAGE_KEY);this.users=e||[]}catch{console.log("No users found, creating new storage"),this.users=[],yield this.saveUsers()}})}saveUsers(){return a(this,null,function*(){try{yield this.storageService.set(this.USERS_STORAGE_KEY,this.users)}catch(e){console.error("Error saving users:",e)}})}generateUserId(){return"user_"+Date.now().toString()+"_"+Math.random().toString(36).substr(2,9)}generateToken(){return Math.random().toString(36).substr(2,15)+Date.now().toString(36)}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}hashPassword(e){return a(this,null,function*(){let t=new TextEncoder().encode(e+"salt_key_for_hashing"),o=yield crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(o)).map(u=>u.toString(16).padStart(2,"0")).join("")})}verifyPassword(e,r){return a(this,null,function*(){return(yield this.hashPassword(e))===r})}handleAuthError(e){var r;return(e==null?void 0:e.error)==="popup_closed_by_user"?new Error("Sign-in was cancelled. Please try again."):(e==null?void 0:e.error)==="access_denied"?new Error("Access denied. Please grant permission to continue."):(r=e==null?void 0:e.message)!=null&&r.includes("redirect_uri_mismatch")?new Error("Authentication configuration error. Please contact support."):new Error("Sign-in failed. Please try again later.")}restoreUserSession(){return a(this,null,function*(){try{let e=this.storageService.getFromLocalStorage("currentUser");e&&(this.currentUserSubject.next(e),console.log("User session restored:",e))}catch(e){console.error("Failed to restore user session:",e)}})}saveUserSession(e){try{this.storageService.setToLocalStorage("currentUser",e)}catch(r){console.error("Failed to save user session:",r)}}clearUserSession(){try{this.storageService.removeFromLocalStorage("currentUser")}catch(e){console.error("Failed to clear user session:",e)}}saveWorkProgressBeforeLogout(){return a(this,null,function*(){try{let e=this.getCurrentUserSync();if(!e)return;let r={inventoryData:this.storageService.getFromLocalStorage("inventoryData")||[],currentTab:this.storageService.getFromLocalStorage("currentTab")||"inventory",formData:this.storageService.getFromLocalStorage("formData")||{},timestamp:new Date().toISOString()},t=`work_progress_${e.id}`;yield this.storageService.set(t,r),console.log("Work progress saved before logout")}catch(e){console.error("Error saving work progress before logout:",e)}})}};s.\u0275fac=function(r){return new(r||s)(c(E),c(d))},s.\u0275prov=l({token:s,factory:s.\u0275fac,providedIn:"root"});let i=s;return i})();var k=(()=>{let s=class s{calculateSurfaceArea(e,r){let t;e.thickness>0?t=2*(e.length*e.width+e.length*e.thickness+e.width*e.thickness):t=e.length*e.width;let o=t*r,n=this.convertToSquareFeet(o,e.unit);return{value:n,unit:"ft\xB2",formatted:`${n.toFixed(2)} ft\xB2`}}convertToSquareFeet(e,r){let o={cm:.00107639,mm:107639e-10,in:.00694444,m:10.7639,ft:1}[r]||1;return e*o}validateDimensions(e){return e.length>0&&e.width>0}};s.\u0275fac=function(r){return new(r||s)},s.\u0275prov=l({token:s,factory:s.\u0275fac,providedIn:"root"});let i=s;return i})();var D=(()=>{let s=class s{constructor(e,r){this.storageService=e,this.surfaceAreaCalculator=r,this.inventoryItems=[],this.STORAGE_KEY="inventoryItems",this.loadFromStorage()}getInventory(){return[...this.inventoryItems]}getItem(e){return this.inventoryItems.find(r=>r.id===e)}addItem(e){let r=y(g({id:this.generateId()},e),{timestamp:new Date().toISOString(),dateAdded:new Date().toLocaleString()});e.dimensions&&this.surfaceAreaCalculator.validateDimensions(e.dimensions)&&(r.totalSurfaceArea=this.surfaceAreaCalculator.calculateSurfaceArea(e.dimensions,e.quantity)),this.inventoryItems.push(r),this.saveToStorage()}updateItem(e,r){let t=this.inventoryItems.findIndex(o=>o.id===e);if(t>-1){if(this.inventoryItems[t]=y(g(g({},this.inventoryItems[t]),r),{lastModified:new Date().toLocaleString()}),r.quantity!==void 0||r.dimensions!==void 0){let o=this.inventoryItems[t];o.dimensions&&this.surfaceAreaCalculator.validateDimensions(o.dimensions)?o.totalSurfaceArea=this.surfaceAreaCalculator.calculateSurfaceArea(o.dimensions,o.quantity):delete o.totalSurfaceArea}this.saveToStorage()}}deleteItem(e){this.inventoryItems=this.inventoryItems.filter(r=>r.id!==e),this.saveToStorage()}getItemsByCategory(e){return this.inventoryItems.filter(r=>r.category===e)}getTotalItems(){return this.inventoryItems.reduce((e,r)=>e+r.quantity,0)}getTotalValue(){return this.inventoryItems.reduce((e,r)=>e+(r.price||0)*r.quantity,0)}searchItems(e){let r=e.toLowerCase();return this.inventoryItems.filter(t=>{var o,n;return t.name.toLowerCase().includes(r)||((o=t.description)==null?void 0:o.toLowerCase().includes(r))||((n=t.category)==null?void 0:n.toLowerCase().includes(r))})}loadFromStorage(){try{let e=this.storageService.getFromLocalStorage(this.STORAGE_KEY);e&&(this.inventoryItems=e)}catch(e){console.error("Error loading inventory from storage:",e),this.inventoryItems=[]}}saveToStorage(){try{this.storageService.setToLocalStorage(this.STORAGE_KEY,this.inventoryItems)}catch(e){console.error("Error saving inventory to storage:",e)}}generateId(){return Date.now().toString()+"_"+Math.random().toString(36).substr(2,9)}};s.\u0275fac=function(r){return new(r||s)(c(d),c(k))},s.\u0275prov=l({token:s,factory:s.\u0275fac,providedIn:"root"});let i=s;return i})();var b=(()=>{let s=class s{constructor(e,r){this.storageService=e,this.authService=r,this.WORK_PROGRESS_STORAGE_KEY="work_progress",this.workProgressData=[],this.loadWorkProgress()}saveWorkProgress(e){return a(this,null,function*(){try{let r=this.authService.getCurrentUserSync();if(!r){console.warn("No user logged in, cannot save work progress");return}let t=this.workProgressData.findIndex(n=>n.userId===r.id),o={userId:r.id,lastSaved:new Date().toISOString(),data:e,inventoryData:e.inventoryData||[],currentTab:e.currentTab||"inventory",formData:e.formData||{}};t>=0?this.workProgressData[t]=o:this.workProgressData.push(o),yield this.persistWorkProgress(),console.log("Work progress saved successfully")}catch(r){console.error("Error saving work progress:",r)}})}getWorkProgress(e){return a(this,null,function*(){try{let r=this.authService.getCurrentUserSync(),t=e||(r==null?void 0:r.id);return t&&this.workProgressData.find(n=>n.userId===t)||null}catch(r){return console.error("Error getting work progress:",r),null}})}clearWorkProgress(e){return a(this,null,function*(){try{let r=this.authService.getCurrentUserSync(),t=e||(r==null?void 0:r.id);if(!t)return;this.workProgressData=this.workProgressData.filter(o=>o.userId!==t),yield this.persistWorkProgress(),console.log("Work progress cleared successfully")}catch(r){console.error("Error clearing work progress:",r)}})}restoreWorkProgress(){return a(this,null,function*(){try{let e=this.authService.getCurrentUserSync();if(!e)return;let r=yield this.getWorkProgress(e.id);r&&(r.inventoryData&&this.storageService.setToLocalStorage("inventoryData",r.inventoryData),r.currentTab&&this.storageService.setToLocalStorage("currentTab",r.currentTab),r.formData&&this.storageService.setToLocalStorage("formData",r.formData),console.log("Work progress restored successfully"))}catch(e){console.error("Error restoring work progress:",e)}})}autoSaveWorkProgress(){return a(this,null,function*(){try{if(!this.authService.getCurrentUserSync())return;let r={inventoryData:this.getInventoryData(),currentTab:this.getCurrentTab(),formData:this.getFormData(),timestamp:new Date().toISOString()};yield this.saveWorkProgress(r)}catch(e){console.error("Error auto-saving work progress:",e)}})}saveCurrentState(){return a(this,null,function*(){yield this.autoSaveWorkProgress()})}getAllUserProgress(){return[...this.workProgressData]}getProgressByDateRange(e,r){return a(this,null,function*(){return this.workProgressData.filter(t=>{let o=new Date(t.lastSaved);return o>=e&&o<=r})})}loadWorkProgress(){return a(this,null,function*(){try{let e=yield this.storageService.get(this.WORK_PROGRESS_STORAGE_KEY);this.workProgressData=e||[]}catch{console.log("No work progress file found, creating new one"),this.workProgressData=[]}})}persistWorkProgress(){return a(this,null,function*(){try{yield this.storageService.set(this.WORK_PROGRESS_STORAGE_KEY,this.workProgressData)}catch(e){console.error("Error persisting work progress:",e)}})}getInventoryData(){return this.storageService.getFromLocalStorage("inventoryData")||[]}getCurrentTab(){return this.storageService.getFromLocalStorage("currentTab")||"inventory"}getFormData(){return this.storageService.getFromLocalStorage("formData")||{}}};s.\u0275fac=function(r){return new(r||s)(c(d),c(w))},s.\u0275prov=l({token:s,factory:s.\u0275fac,providedIn:"root"});let i=s;return i})();var x=(()=>{let s=class s{constructor(e,r,t){this.authService=e,this.inventoryService=r,this.workProgressService=t}createAuthService(){return this.authService}createInventoryService(){return this.inventoryService}createWorkProgressService(){return this.workProgressService}};s.\u0275fac=function(r){return new(r||s)(c(w),c(D),c(b))},s.\u0275prov=l({token:s,factory:s.\u0275fac,providedIn:"root"});let i=s;return i})();export{x as a};
